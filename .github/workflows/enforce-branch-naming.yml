name: Enforce Branch Naming Convention

on:
  push:
    # Trigger on all branches except main
    branches-ignore:
      - main
  pull_request:
    # Trigger on PRs to all branches except main
    branches-ignore:
      - main
  workflow_dispatch:

permissions:
  contents: read

jobs:
  validate-branch-name:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Get branch name
        id: branch
        run: |
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            # For PRs, get the source branch name
            BRANCH_NAME="${{ github.head_ref }}"
          elif [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            # For manual dispatch, use the ref_name
            BRANCH_NAME="${{ github.ref_name }}"
          else
            # For push events, use ref_name (branch being pushed to)
            BRANCH_NAME="${{ github.ref_name }}"
          fi
          echo "branch_name=$$BRANCH_NAME" >> $$GITHUB_OUTPUT
          echo "üîç Checking branch name: $$BRANCH_NAME"
      
      - name: Validate branch naming pattern
        run: |
          BRANCH_NAME="${{ steps.branch.outputs.branch_name }}"
          PATTERN="([1-9]|1[0-9]|20)-F"
          
          echo "üìã Required pattern: $$PATTERN"
          echo "üîç Branch name to validate: $$BRANCH_NAME"
          
          # Use grep with extended regex for pattern matching
          # The pattern should match numbers 1-20 followed by -B or -F
          if ! echo "$$BRANCH_NAME" | grep -qE "^$$PATTERN$$"; then
            echo "‚ùå ERROR: Branch name '$$BRANCH_NAME' does not match the required pattern: $$PATTERN"
            echo ""
            echo "üìã Branch naming convention for Frontend repositories:"
            echo "   - Must match pattern: $$PATTERN"
            echo "   - Examples: 1-F, 2-F, 20-F"
            echo "   - Format: [Number 1-20]-[B for Backend, F for Frontend]"
            echo "   - Invalid examples: feature-branch, dev, 21-B, abc-123"
            echo ""
            echo "üö´ This workflow will fail to prevent using invalid branch names."
            exit 1
          else
            echo "‚úÖ SUCCESS: Branch name '$$BRANCH_NAME' matches the required pattern: $$PATTERN"
          fi
